<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Applications forecast</title>
<style>
:root{--brand:#00aff0;--navy:#0f1d66;}
html,body{margin:0;padding:0;font-family:Arial,Helvetica,sans-serif;background:#fff;color:var(--navy);} 
.grid{display:flex;gap:3rem;max-width:1200px;margin:0 auto;padding:3rem 1rem;}
main{flex:3;}
aside{flex:1;display:flex;align-items:center;}
/* slightly smaller heading */
h1{font-size:3.2rem;font-weight:700;line-height:1.15;margin:0 0 1rem;}
.coloured{color:var(--brand);} 

p.lead{font-size:1.15rem;margin:0 0 2.5rem;}

/* equal, larger sizing for controls */
input[type=text],select{
  border:2px solid var(--brand);
  border-radius:30px;
  padding:1rem 1.5rem;
  font-size:1.1rem;
  width:55ch; /* wider to fit long words like “Specialization” */
  box-sizing:border-box;
  margin:0 0 1.5rem;
}
#result{font-size:1.25rem;font-weight:600;margin-top:1.5rem;}
img{width:100%;height:auto;}
</style>
</head>
<body>
<div class="grid">
  <main>
    <h1>Discover <span class="coloured">how many applications</span><br>you could receive with us</h1>
    <p class="lead">Simply enter a job title and location to estimate the number of candidates likely to apply before you post on eFinancialCareers.</p>

    <!-- job title input with autocomplete -->
    <input id="role" type="text" placeholder="What role are you hiring for" list="jobs">
    <datalist id="jobs"></datalist>

    <!-- location dropdown populated dynamically, width matches input -->
    <select id="location" disabled>
      <option value="" disabled selected>Select location</option>
    </select>

    <p id="result"></p>
  </main>

  <aside>
    <img src="https://i.ibb.co/QFLTq3Fm/efc.png" alt="eFinancialCareers logo">
  </aside>
</div>

<script>
const csvUrl='https://docs.google.com/spreadsheets/d/e/2PACX-1vTXMMPUO1a6egT3JmCgKuE6Lfo6GW2gl6F1pnxcoHFj4tQ8komKW7g8HQ_zu6O039HOiMWo3lv8-Mkc/pub?output=csv';

// DOM references
const roleInput=document.getElementById('role');
const jobsList=document.getElementById('jobs');
const locSelect=document.getElementById('location');
const result=document.getElementById('result');

// helpers
function clearChildren(el){while(el.firstChild){el.removeChild(el.firstChild);}}
function csvToArray(t){return t.trim().split(/\r?\n/).map(l=>l.split(','));}

fetch(csvUrl)
  .then(r=>r.text())
  .then(txt=>{
    const rows = csvToArray(txt).slice(1).filter(r=>r.length>=4);
    const data = rows.map(r=>({title:r[0], country:r[1], apps:+r[2], similar:+r[3]}));
    const titles = [...new Set(data.map(d=>d.title))].sort();

    // populate job datalist
    titles.forEach(t=>{const o=document.createElement('option');o.value=t;jobsList.appendChild(o);});

    // populate locations for selected title
    function populateLocations(){
      const title = roleInput.value.trim();
      clearChildren(locSelect);
      const placeholder=document.createElement('option');
      placeholder.value=""; placeholder.disabled=true; placeholder.selected=true;
      placeholder.textContent='Select location';
      locSelect.appendChild(placeholder);

      if(!titles.includes(title)){
        locSelect.disabled = true;
        result.textContent='';
        return;
      }
      const locs = [...new Set(data.filter(d=>d.title===title).map(d=>d.country))].sort();
      locs.forEach(l=>{const o=document.createElement('option');o.value=l;o.textContent=l;locSelect.appendChild(o);} );
      locSelect.disabled = false;
    }

    function filter(){
      const title = roleInput.value.trim();
      const country = locSelect.value;
      if(!title || !country){result.textContent='';return;}
      const row = data.find(d=>d.title===title && d.country===country);
      if(row){
        result.innerHTML = `In this first 30 days, expect <span class="coloured">${row.apps}</span> applications, based on data from ${row.similar} similar jobs`;
      }else{
        result.textContent='No forecast available for that role and location';
      }
    }

    // wire up events
    roleInput.addEventListener('input', ()=>{populateLocations(); filter();});
    locSelect.addEventListener('change', filter);
  })
  .catch(e=>{console.error(e); result.textContent='Unable to load data';});
</script>
</body>
</html>
